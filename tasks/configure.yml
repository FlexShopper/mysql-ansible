# file: mysql/tasks/configure.yml

- name: Disable apparmor step 1
  shell: ln -s /etc/apparmor.d/usr.sbin.mysqld /etc/apparmor.d/disable/

- name: Disable apparmor step 2
  shell: apparmor_parser -R /etc/apparmor.d/usr.sbin.mysqld

- name: MySQL | Ensure datadir exists
  file: path={{mysql_datadir}} state=directory owner=mysql group=mysql

- name: MySQL | Ensure tmpdir exists
  file: path={{mysql_tmpdir}} state=directory owner=mysql group=mysql

- name: MySQL | Update the my.cnf
  template:
    src: etc_mysql_my.cnf.j2
    dest: /etc/mysql/my.cnf
    owner: root
    group: root
    mode: 0644
  notify:
    - restart mysql
